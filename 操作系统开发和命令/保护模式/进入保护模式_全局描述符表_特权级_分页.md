- [全局描述符表](#全局描述符表)
- [进入保护模式](#进入保护模式)
- 



　**DPL** 表示段或门的特权级。它被存储在段描述符或者门描述符的DPL字段中



### 全局描述符表

全局描述符表( Global Descriptor Table, GDT)是保护模式下内存段的登记表，这是不同于实模式的 显著特征之一 。

LDT 局部描述符表。

LDT需要在GDT中注册。

- 实模式下的用户程序可以破坏存储代码的内存区域，所以要添加个 **内存段类型属性** 来阻止这种行为。

  - 实模式下的用户程序和操作系统是同一级别的，所 以要添加个 **特权级属性** 来区分用户程序和操作系统

  的地位。

**所有描述符都是8位的。**

**GDT 就是描述符数组， 选择子是索引值(13位)。(段寄存器中保存选择子和TI全局或局部描述符表索引, RPL请求特权级)**

- GDTR 寄存器存储 GDT的内存地址及大小
  - GDTR是48位寄存器(64位模式下是64位),  高15 ~ 47是GDT内存起始位置, 低 0~15是GDT界限
    - **GDT界限只有16个bit，表示只有 `2^16 / 8=8192` 个段描述符**
    - **默认 GDT的第0描述符不可用，从1开始才可以使用。**
- **使用 lgdt 指令访问 GDTR寄存器**



##### GDTR与LDTR

###### GDTR

```register
     47                                               16 15                        0
     +--------------------------------------------------+---------------------------+
GDTR |           32位线性基地址                          |        16位表长度          |
     +--------------------------------------------------+---------------------------+
```

加载GDTR寄存器指令

```assembly
!	           gdt_48
! 47              16 15         0
!+------------------+-----------+
!|   32位线性基地址  | gdt表长度  | gdt_48
!+------------------+-----------+
ldtr gdt_48
```

`gdtr`用于加载全局描述符表寄存器GDTR。它的操作数(gdt_48)有6个字节。前2字节(字节0-1)是描述表的字节长度值；后4字节(字节2-5)是描述符表的32位线性基地址。

###### IDRT

IDRT同GDTR



## 进入保护模式

- 所需内容
  - GDT   (指令 lgdt)
  - 打开A20总线
    - `将端口0x92的第1位设置为1即可 (0000_0010B)`
  - 将CR0 寄存器的 PE(第0位) 设置为1
